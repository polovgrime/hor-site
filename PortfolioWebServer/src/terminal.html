<!DOCTYPE html>
<html>

<head>
    <title>Horrest's presonal blog</title>
</head>

<body>
    <main>
        <div id="terminal">

        </div>
        <div class="helper">
            Type help for the commands!
        </div>
        <div class="inputField">
            <span class="username">welcome@user:</span>
            <span class="tilda">~</span>
            <span class="smth">$</span>
            <input type="text" id="input" onblur="this.focus()" autofocus />
        </div>
    </main>
</body>
<style>
    body {
        background-color: #000;
        color: #4e9a06;
    }

    .username {
        color: red;
    }

    .inputField span.tilda {
        color: lightblue;
    }

    .helper {
        padding-top: 25px;
    }

    .inputField {
        color: #fff;
        padding-top: 25px;
    }

    input[type="text"] {
        color: #fff;
        background-color: transparent;
        border: none;
        width: calc(100% - 150px);
    }

    input[type="text"]:focus {
        outline-width: 0;
    }

    #terminal {
        width: calc(100% - 50px);
        height: 400px;
        overflow-y: scroll;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    #terminal::-webkit-scrollbar {
        display: none;
    }
</style>
<script>
    const links = [
        {
            url: 'https://github.com/polovgrime',
            title: 'Github'
        },
        {
            url: 'https://www.linkedin.com/in/anton-polovnikov-084956219/',
            title: 'LinkedIn'
        }
    ];

    const commands = {
        'about': composeAbout,
        'links': drawLinks,
        'openlink': openLink,
        'projects': composeProjects
    };

    const projects = [
        {
            url: '\\',
            title: 'Website',
            description: 'For now, this website. Not really, but gonna connect datasource for this and keep updating info here.'
        }
    ]

    commands['help'] = () => draw(Object.keys(commands).join(', '));

    const input = document.getElementById('input');
    const terminal = document.getElementById('terminal');
    const usedCommands = [];
    let currentCmdIndex = 0;

    input.focus();

    input.addEventListener('keyup', function (event) {
        if (event.key === 'Enter') {
            resolveCommand(input.value);
        }

        if (event.key === 'ArrowUp') {
            prevCommand();
        }

        if (event.key === 'ArrowDown') {
            nextCommand();
        }
    });

    function resolveCommand(command) {
        clearInput();
        addCommand(command);

        var attrs = command.split(" ");

        if (attrs[0] == "clear") {
            clear();
            return;
        }

        if (commands.hasOwnProperty(attrs[0]) == false) {
            commandNotFound(attrs[0]);
        } else {
            commands[attrs[0]](attrs);
        }
    }

    function commandNotFound(name) {
        draw('Command ' + name + ' was not found');
    }

    function draw(text) {
        let newElement = document.createElement('div');
        newElement.innerHTML = text;
        drawElement(newElement);
    }

    function drawElement(el) {
        terminal.appendChild(el);
        terminal.scrollTop = terminal.scrollHeight;
        terminal.appendChild(document.createElement('br'));
    }

    function clear() {
        terminal.innerHTML = "";
    }

    function clearInput() {
        input.value = "";
    }

    function addCommand(command) {
        if (command == usedCommands[usedCommands.length - 1]) {
            return;
        }
        usedCommands.push(command);
        currentCmdIndex = usedCommands.length;
    }

    function prevCommand() {
        currentCmdIndex--;
        if (currentCmdIndex <= 0) {
            currentCmdIndex = 0;
        }

        typeCommand();
    }

    function nextCommand() {
        currentCmdIndex++;
        if (currentCmdIndex >= usedCommands.length) {
            currentCmdIndex = usedCommands.length - 1;
        }

        typeCommand();
    }

    function typeCommand() {
        if (usedCommands.length == 0) {
            return;
        }

        input.value = usedCommands[currentCmdIndex];
    }

    function composeAbout() {
        const aboutMe = 'My name\'s Anton, I\'m a 26 years old programmer. Currently a .NET backend developer, who wishes to become a professional gamedev.';
        const myStack = 'Have experience in .NET (through 3.5 to 7). JavaScript, vue.js, node.js (not proud). Unity, but not deep. Godot (same thing, but I usually use any game engine as a platform to recreate game mechanics, not really into any real engine coding yet)';
        const aboutThisWebsite = 'This website is made with no frameworks on frontend or backend. Plain html js css on frontend and .NET on backend,' +
            'not really that pure since it\'s .NET, but still. Custom webserver. Currently I\'m working on my own http1.1 (then http2) implementation';
        
        draw([aboutMe, myStack, aboutThisWebsite].join('</br>'));
    }

    function drawLinks() {
        draw(links.map(i => `<a href="${i.url}">${i.title}</a>`).join('</br>'));
    }

    function openLink(attrs) {
        let link = links.filter(link => link.title == attrs[1])[0];

        if (link === undefined) {
            draw(`Link ${attrs[1]} was not found`);
            return;
        }

        draw(`Opening ${link.title}...`);
        window.open(link.url, '_blank');
    }

    function composeProjects(attrs) {
        if (attrs[1] !== undefined)
        {
            displaySingleProject(attrs[1]);
        }

        let composed = projects.map(project => {
            let projectDiv = document.createElement('div');
            let title = document.createElement('a');
            title.href = project.url;
            title.innerHTML = project.title;

            projectDiv.appendChild(title);

            let description = document.createElement('span');
            let descriptionText = ': ' + project.description;
            
            if (descriptionText.length > 50) {
                descriptionText = descriptionText.substring(0, 50) + '... '
            }

            description.innerHTML = descriptionText;

            projectDiv.appendChild(description);

            let expandButton = document.createElement('a');

            expandButton.onclick = () => displaySingleProject(project);
            expandButton.href = '#';
            expandButton.innerHTML = 'Expand';

            projectDiv.appendChild(expandButton);

            return projectDiv;
        });

       composed.forEach(project => drawElement(project));
    }

    function displaySingleProject(project) {
        let projectDiv = document.createElement('div');
        let title = document.createElement('a');
        title.href = project.url;
        title.innerHTML = project.title;

        projectDiv.appendChild(title);
        projectDiv.appendChild(document.createElement('br'));

        let description = document.createElement('div');
        description.innerHTML = project.description;
        
        projectDiv.appendChild(description);

        drawElement(projectDiv);
    }
</script>

</html>